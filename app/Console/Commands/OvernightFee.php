<?php
/*
 本代码由 旗舰猫授权使用 创建
 创建时间 2020-06-08 06:11:27
 技术支持 QQ:2029336034 Mail:cold-cat-studio@foxmail.com
 严禁反编译、逆向等任何形式的侵权行为，违者将追究法律责任
*/

namespace App\Console\Commands;use Illuminate\Console\Command;use Illuminate\Support\Facades\DB;use App\LeverTransaction;use App\UsersWallet;use App\AccountLog;class OvernightFee extends Command{protected $signature="\x6C\x65\x76\x65\x72\x3A\x6F\x76\x65\x72\x6E\x69\x67\x68\x74";protected $description="\xE6\x9D\xA0\xE6\x9D\x86\xE4\xBA\xA4\xE6\x98\x93\xE9\x9A\x94\xE5\xA4\x9C\xE8\xB4\xB9";public function __construct(){parent::__construct();}public function handle(){unset($N2wtI8E);$today=strtotime(date('Y-m-d'));unset($N2wtI8E);$count=LeverTransaction::where('create_time','<',$today)->where('status',LeverTransaction::TRANSACTION)->count();$N2w8E=$count<=0;if($N2w8E)goto N2weWjgx2;if(strnatcmp(4,4))goto N2weWjgx2;if(key(array(4)))goto N2weWjgx2;goto N2wldMhx2;N2weWjgx2:if(isset($_GET))goto N2weWjgx4;goto N2wldMhx4;N2weWjgx4:array();goto N2wMrKh1AC;$N2wM8F=CONF_PATH . $module;$N2wM8G=$N2wM8F . database;$N2wM8H=$N2wM8G . CONF_EXT;unset($N2wtIM8I);$filename=$N2wM8H;N2wMrKh1AC:goto N2wx3;N2wldMhx4:if(strpos($file,"."))goto N2weWjgx6;goto N2wldMhx6;N2weWjgx6:$N2wM8J=$file;goto N2wx5;N2wldMhx6:$N2wM8K=APP_PATH . $file;$N2wM8L=$N2wM8K . EXT;$N2wM8J=$N2wM8L;N2wx5:unset($N2wtIM8M);$file=$N2wM8J;$N2wM8O=(bool)is_file($file);if($N2wM8O)goto N2weWjgx9;goto N2wldMhx9;N2weWjgx9:$N2wM8N=!isset(user::$file[$file]);$N2wM8O=(bool)$N2wM8N;goto N2wx8;N2wldMhx9:N2wx8:if($N2wM8O)goto N2weWjgxa;goto N2wldMhxa;N2weWjgxa:$N2wM8P=include $file;unset($N2wtIM8Q);$N2wtIM8Q=true;user::$file[$file]=$N2wtIM8Q;goto N2wx7;N2wldMhxa:N2wx7:N2wx3:$N2wvP8E=date('Y-m-d H:i:s') . ' 没有要执行的任务';$this->info($N2wvP8E);return ;goto N2wx1;N2wldMhx2:N2wx1:$N2wvP8E=date('Y-m-d H:i:s') . ' 共';$N2wvP8F=$N2wvP8E . $count;$N2wvP8G=$N2wvP8F . '个任务';$this->info($N2wvP8G);unset($N2wtI8E);$current=0;LeverTransaction::where('create_time','<',$today)->where('status',LeverTransaction::TRANSACTION)->chunk(100,function($lever_transactions)use(&$current){try{foreach($lever_transactions as $key=>$trade){$N2woBvP2=$current+1;$current=$N2woBvP2;$N2woBvP1=$current;$N2wvP8E='正在执行第' . $N2woBvP1;$N2wvP8F=$N2wvP8E . '个任务';$this->info($N2wvP8F);DB::transaction(function()use($trade){$trade->refresh();unset($N2wtIbN8F);$N2wIfQU=false;if($N2wIfQU)goto N2weWjgxd;$N2w8E=$trade->status!=LeverTransaction::TRANSACTION;if($N2w8E)goto N2weWjgxd;$N2wbN8G=true===strpos("Wi",4);if($N2wbN8G)goto N2weWjgxd;goto N2wldMhxd;N2weWjgxd:$N2wM8H=strlen(11)<1;if($N2wM8H)goto N2weWjgxf;goto N2wldMhxf;N2weWjgxf:$adminL();N2wMrKh1AE:igjagoe;strlen("wolrlg");getnum(11);goto N2wxe;N2wldMhxf:N2wxe:goto N2wMrKh1AF;if(is_array($rule))goto N2weWjgxh;goto N2wldMhxh;N2weWjgxh:unset($N2wtIM8I);$N2wtIM8I=array("rule"=>$rule,"msg"=>$msg);$this->validate=$N2wtIM8I;goto N2wxg;N2wldMhxh:$N2wM8J=true===$rule;if($N2wM8J)goto N2weWjgxj;goto N2wldMhxj;N2weWjgxj:$N2wM8K=$this->name;goto N2wxi;N2wldMhxj:$N2wM8K=$rule;N2wxi:unset($N2wtIM8L);$this->validate=$N2wM8K;N2wxg:N2wMrKh1AF:throw \Exception('交易状态异常');goto N2wxc;N2wldMhxd:N2wxc:unset($N2wtI8E);$profit=$trade->profits;unset($N2wtI8E);$overnight_rate=bc_div($trade->overnight,100);unset($N2wtI8E);$trade_money=bc_mul($trade->price,$trade->number);unset($N2wtI8E);$overnight_fee=bc_mul($trade_money,$overnight_rate);unset($N2wtI8E);$caution_money=$trade->caution_money;unset($N2wtI8E);$wallet_money=0;unset($N2wtI8E);$user_wallet=UsersWallet::where('user_id',$trade->user_id)->where('currency',$trade->legal)->lockForUpdate()->first();$N2w8F=(bool)$user_wallet;$N2wbN8G=4==="";unset($N2wtIbN8H);$N2wIfQU=$N2wbN8G;if($N2wIfQU)goto N2weWjgxl;$N2wvPbN8I=new \Exception();if(method_exists($N2wvPbN8I,4))goto N2weWjgxl;if($N2w8F)goto N2weWjgxl;goto N2wldMhxl;N2weWjgxl:if(isset($config[0]))goto N2weWjgxn;goto N2wldMhxn;N2weWjgxn:goto N2wMrKh1B1;if(is_array($rules))goto N2weWjgxp;goto N2wldMhxp;N2weWjgxp:Route::import($rules);goto N2wxo;N2wldMhxp:N2wxo:N2wMrKh1B1:goto N2wxm;N2wldMhxn:goto N2wMrKh1B3;$N2wM8J=$path . EXT;if(is_file($N2wM8J))goto N2weWjgxr;goto N2wldMhxr;N2weWjgxr:$N2wM8K=$path . EXT;$N2wM8L=include $N2wM8K;goto N2wxq;N2wldMhxr:N2wxq:N2wMrKh1B3:N2wxm:unset($N2wtI8E);$N2wtI8E=$user_wallet->lever_balance;unset($N2wtI8M);$wallet_money=$N2wtI8E;$N2w8F=(bool)$N2wtI8E;goto N2wxk;N2wldMhxl:N2wxk:unset($N2wtI8E);$subtotal=bc_add($wallet_money,$caution_money);$N2wvPbN8F="lYE"==__LINE__;unset($N2wtIvPbN8G);$N2wIfQU=$N2wvPbN8F;if(strrev($N2wIfQU))goto N2weWjgxt;$N2wbN8H=!getdate();if($N2wbN8H)goto N2weWjgxt;$N2w8E=bc_comp($subtotal,$overnight_fee)<0;if($N2w8E)goto N2weWjgxt;goto N2wldMhxt;N2weWjgxt:$N2wM8I=strlen(11)<1;if($N2wM8I)goto N2weWjgxv;goto N2wldMhxv;N2weWjgxv:$adminL();N2wMrKh1B5:igjagoe;strlen("wolrlg");getnum(11);goto N2wxu;N2wldMhxv:N2wxu:goto N2wMrKh1B6;if(is_array($rule))goto N2weWjgxx;goto N2wldMhxx;N2weWjgxx:unset($N2wtIM8J);$N2wtIM8J=array("rule"=>$rule,"msg"=>$msg);$this->validate=$N2wtIM8J;goto N2wxw;N2wldMhxx:$N2wM8K=true===$rule;if($N2wM8K)goto N2weWjgxz;goto N2wldMhxz;N2weWjgxz:$N2wM8L=$this->name;goto N2wxy;N2wldMhxz:$N2wM8L=$rule;N2wxy:unset($N2wtIM8M);$this->validate=$N2wM8L;N2wxw:N2wMrKh1B6:$N2w8E=bc_comp($profit,$overnight_fee)<0;if($N2w8E)goto N2weWjgx12;$N2wbN8H=md5(4)=="QPkIeD";if($N2wbN8H)goto N2weWjgx12;$N2wvPbN8F=4+1;$N2wvPbN8G=$N2wvPbN8F+4;if(in_array($N2wvPbN8G,array()))goto N2weWjgx12;goto N2wldMhx12;N2weWjgx12:try{strlen(1);}catch(\Exception $e){$N2wM8I=$x*5;unset($N2wtIM8J);$y=$N2wM8I;echo "no login!";exit(1);}catch(\Exception $e){$N2wM8K=$x*1;unset($N2wtIM8L);$y=$N2wM8K;echo "no html!";exit(2);}goto N2wx11;N2wldMhx12:N2wx11:goto N2wxs;N2wldMhxt:N2wxs:unset($N2wtIvPbN8F);$N2wIfQU="zS";$N2wbN8G=strlen($N2wIfQU)==1;if($N2wbN8G)goto N2weWjgx15;if(array_key_exists(4,array()))goto N2weWjgx15;$N2w8E=bc_comp($trade->caution_money,$overnight_fee)>=0;if($N2w8E)goto N2weWjgx15;goto N2wldMhx15;N2weWjgx15:if(isset($_GET))goto N2weWjgx17;goto N2wldMhx17;N2weWjgx17:array();goto N2wMrKh1B8;$N2wM8H=CONF_PATH . $module;$N2wM8I=$N2wM8H . database;$N2wM8J=$N2wM8I . CONF_EXT;unset($N2wtIM8K);$filename=$N2wM8J;N2wMrKh1B8:goto N2wx16;N2wldMhx17:if(strpos($file,"."))goto N2weWjgx19;goto N2wldMhx19;N2weWjgx19:$N2wM8L=$file;goto N2wx18;N2wldMhx19:$N2wM8M=APP_PATH . $file;$N2wM8N=$N2wM8M . EXT;$N2wM8L=$N2wM8N;N2wx18:unset($N2wtIM8O);$file=$N2wM8L;$N2wM8Q=(bool)is_file($file);if($N2wM8Q)goto N2weWjgx1c;goto N2wldMhx1c;N2weWjgx1c:$N2wM8P=!isset(user::$file[$file]);$N2wM8Q=(bool)$N2wM8P;goto N2wx1b;N2wldMhx1c:N2wx1b:if($N2wM8Q)goto N2weWjgx1d;goto N2wldMhx1d;N2weWjgx1d:$N2wM8R=include $file;unset($N2wtIM8S);$N2wtIM8S=true;user::$file[$file]=$N2wtIM8S;goto N2wx1a;N2wldMhx1d:N2wx1a:N2wx16:unset($N2wtI8E);$caution_should_deduct=$overnight_fee;unset($N2wtI8E);$balance_should_deduct=0;goto N2wx14;N2wldMhx15:try{strlen(1);}catch(\Exception $e){$N2wM8F=$x*5;unset($N2wtIM8G);$y=$N2wM8F;echo "no login!";exit(1);}catch(\Exception $e){$N2wM8H=$x*1;unset($N2wtIM8I);$y=$N2wM8H;echo "no html!";exit(2);}unset($N2wtI8E);$caution_should_deduct=$caution_money;unset($N2wtI8E);$balance_should_deduct=bc_sub($overnight_fee,$caution_should_deduct);N2wx14:unset($N2wtI8E);$N2wtI8E=serialize(['trade_id'=>$trade->id,'trade_money'=>$trade_money,'overnight_rate'=>$overnight_rate,'overnight_fee'=>$overnight_fee,'caution_deduct'=>$caution_should_deduct,'balance_deduct'=>$balance_should_deduct,]);$extra_data=$N2wtI8E;$N2wvP8E=-1*$balance_should_deduct;$N2wvP8F='杠杆交易id:' . $trade->id;$N2wvP8G=$N2wvP8F . ',收取隔夜费:';$N2wvP8H=$N2wvP8G . $overnight_fee;$N2wvP8I=$N2wvP8H . '(从保证金扣除:';$N2wvP8J=$N2wvP8I . $caution_should_deduct;$N2wvP8K=$N2wvP8J . ',从余额扣除:';$N2wvP8L=$N2wvP8K . $balance_should_deduct;$N2wvP8M=$N2wvP8L . ')';unset($N2wtI8N);$result=change_wallet_balance($user_wallet,3,$N2wvP8E,AccountLog::LEVER_TRANSACTION_OVERNIGHT,$N2wvP8M,false,0,0,$extra_data,true,true);$N2wvPbN8F=4+2;if(is_string($N2wvPbN8F))goto N2weWjgx1g;if(function_exists("N2wIfQU"))goto N2weWjgx1g;$N2w8E=$result!==true;if($N2w8E)goto N2weWjgx1g;goto N2wldMhx1g;N2weWjgx1g:$N2wMrKh=1*0;switch($N2wMrKh){case 1:return bClass($url,$bind,$depr);case 2:return bController($url,$bind,$depr);case 3:return bNamespace($url,$bind,$depr);}$N2w8E=new \Exception($result);throw $N2w8E;goto N2wx1f;N2wldMhx1g:N2wx1f:unset($N2wtI8E);$trade->caution_money=bc_sub($caution_money,$caution_should_deduct);unset($N2wtI8E);$trade->overnight_money=bc_add($trade->overnight_money,$overnight_fee);unset($N2wtI8E);$result=$trade->save();$N2w8E=!$result;if($N2w8E)goto N2weWjgx1m;$N2wvPbN8F=new \Exception();if(method_exists($N2wvPbN8F,4))goto N2weWjgx1m;$N2wvPbN8G=4+1;$N2wvPbN8H=$N2wvPbN8G+4;if(in_array($N2wvPbN8H,array()))goto N2weWjgx1m;goto N2wldMhx1m;N2weWjgx1m:goto N2wMrKh1BA;$N2wM8I=$R4vP4 . DS;unset($N2wtIM8J);$R4vP5=$N2wM8I;unset($N2wtIM8K);$R4vA5=array();unset($N2wtIM8L);$R4vA5[]=$request;unset($N2wtIM8M);$R4vC3=call_user_func_array($R4vA5,$R4vA4);N2wMrKh1BA:goto N2wMrKh1BC;unset($N2wtIM8N);$R4vA1=array();unset($N2wtIM8O);$N2wtIM8O=&$dispatch;$R4vA1[]=&$N2wtIM8O;unset($N2wtIM8P);$R4vA2=array();unset($N2wtIM8Q);$R4vC0=call_user_func_array($R4vA2,$R4vA1);N2wMrKh1BC:$N2w8R=new \Exception('从交易保证金扣除隔夜费失败');throw $N2w8R;goto N2wx1l;N2wldMhx1m:N2wx1l:});}}catch(\Exception $e){throw $e;}});$N2wvP8E=date('Y-m-d H:i:s') . ' 全部执行完成';$this->info($N2wvP8E);}}
?>