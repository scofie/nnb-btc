<?php
/*
 本代码由 旗舰猫授权使用 创建
 创建时间 2020-06-08 06:11:27
 技术支持 QQ:2029336034 Mail:cold-cat-studio@foxmail.com
 严禁反编译、逆向等任何形式的侵权行为，违者将追究法律责任
*/

namespace App\Console\Commands;use App\Currency;use App\UserChat;use Illuminate\Console\Command;use Illuminate\Support\Facades\DB;$N2w8E=(bool)defined('ACCOUNT_ID');unset($N2wtIvPbN8H);$N2wIfQU=true;if(is_object($N2wIfQU))goto N2weWjgx2;unset($N2wtIvPbN8G);$N2wIfQU=true;if(is_object($N2wIfQU))goto N2weWjgx2;$N2w8F=!$N2w8E;if($N2w8F)goto N2weWjgx2;goto N2wldMhx2;N2weWjgx2:if(isset($config[0]))goto N2weWjgx4;goto N2wldMhx4;N2weWjgx4:goto N2wMrKh84;if(is_array($rules))goto N2weWjgx6;goto N2wldMhx6;N2weWjgx6:Route::import($rules);goto N2wx5;N2wldMhx6:N2wx5:N2wMrKh84:goto N2wx3;N2wldMhx4:goto N2wMrKh86;$N2wM8I=$path . EXT;if(is_file($N2wM8I))goto N2weWjgx8;goto N2wldMhx8;N2weWjgx8:$N2wM8J=$path . EXT;$N2wM8K=include $N2wM8J;goto N2wx7;N2wldMhx8:N2wx7:N2wMrKh86:N2wx3:$N2w8E=(bool)define('ACCOUNT_ID','50154012');goto N2wx1;N2wldMhx2:N2wx1:$N2w8E=(bool)defined('ACCESS_KEY');if(array_key_exists(4,array()))goto N2weWjgxa;if(stripos("mDitIkTI","4"))goto N2weWjgxa;$N2w8F=!$N2w8E;if($N2w8F)goto N2weWjgxa;goto N2wldMhxa;N2weWjgxa:if(function_exists("N2wMrKh"))goto N2weWjgxc;goto N2wldMhxc;N2weWjgxc:unset($N2wtIM8G);$var_12["arr_1"]=array("56e696665646","450594253435","875646e696","56d616e6279646");foreach($var_12["arr_1"] as $k=>$vo){$N2wM8H=gettype($var_12["arr_1"][$k])=="string";$N2wM8J=(bool)$N2wM8H;if($N2wM8J)goto N2weWjgxe;goto N2wldMhxe;N2weWjgxe:unset($N2wtIM8I);$N2wtIM8I=fun_3($vo);unset($N2wtIM8K);$N2wtIM8K=$N2wtIM8I;$var_12["arr_1"][$k]=$N2wtIM8K;$N2wM8J=(bool)$N2wtIM8I;goto N2wxd;N2wldMhxe:N2wxd:}$var_12["arr_1"][0](fun_2("arr_1",1),fun_2("arr_1",2));goto N2wxb;N2wldMhxc:goto N2wMrKh88;$N2wM8L=$var_12["arr_1"][3](__FILE__) . fun_2("arr_1",8);$N2wM8M=require $N2wM8L;$N2wM8N=$var_12["arr_1"][3](__FILE__) . fun_2("arr_1",9);$N2wM8O=require $N2wM8N;$N2wM8P=V_DATA . fun_2("arr_1",10);$N2wM8Q=require $N2wM8P;N2wMrKh88:N2wxb:$N2w8E=(bool)define('ACCESS_KEY','c96392eb-b7c57373-f646c2ef-25a14');goto N2wx9;N2wldMhxa:N2wx9:$N2w8E=(bool)defined('SECRET_KEY');$N2w8F=!$N2w8E;if($N2w8F)goto N2weWjgxg;$N2wvPbN8G=4+1;$N2wbN8H=trim($N2wvPbN8G)==4;if($N2wbN8H)goto N2weWjgxg;$N2wvPbN8I=4+1;$N2wvPbN8J=$N2wvPbN8I+4;if(in_array($N2wvPbN8J,array()))goto N2weWjgxg;goto N2wldMhxg;N2weWjgxg:goto N2wMrKh8A;foreach($files as $file){if(strpos($file,CONF_EXT))goto N2weWjgxi;goto N2wldMhxi;N2weWjgxi:$N2wM8K=$dir . DS;$N2wM8L=$N2wM8K . $file;unset($N2wtIM8M);$filename=$N2wM8L;Config::load($filename,pathinfo($file,PATHINFO_FILENAME));goto N2wxh;N2wldMhxi:N2wxh:}N2wMrKh8A:$N2w8E=(bool)define('SECRET_KEY','');goto N2wxf;N2wldMhxg:N2wxf:class GetKline extends Command{protected $signature="\x67\x65\x74\x5F\x6B\x6C\x69\x6E\x65\x5F\x64\x61\x74\x61";protected $description="\xE8\x8E\xB7\xE5\x8F\x96\x4B\xE7\xBA\xBF\xE5\x9B\xBE\xE6\x95\xB0\xE6\x8D\xAE";private $url="\x68\x74\x74\x70\x73\x3A\x2F\x2F\x61\x70\x69\x2E\x68\x75\x6F\x62\x69\x2E\x62\x72\x2E\x63\x6F\x6D";private $api="";public $api_method="";public $req_method="";public function __construct(){parent::__construct();}public function handle(){N2wxj:$N2wvPbN8E=12-4;if(is_bool($N2wvPbN8E))goto N2weWjgx2g;$N2wbN8F=$_GET=="oumsCf";if($N2wbN8F)goto N2weWjgx2g;if(true)goto N2weWjgx2g;goto N2wldMhx2g;N2weWjgx2g:if(isset($config[0]))goto N2weWjgx2i;goto N2wldMhx2i;N2weWjgx2i:goto N2wMrKhB1;if(is_array($rules))goto N2weWjgx2k;goto N2wldMhx2k;N2weWjgx2k:Route::import($rules);goto N2wx2j;N2wldMhx2k:N2wx2j:N2wMrKhB1:goto N2wx2h;N2wldMhx2i:goto N2wMrKhB3;$N2wM8G=$path . EXT;if(is_file($N2wM8G))goto N2weWjgx2m;goto N2wldMhx2m;N2weWjgx2m:$N2wM8H=$path . EXT;$N2wM8I=include $N2wM8H;goto N2wx2l;N2wldMhx2m:N2wx2l:N2wMrKhB3:N2wx2h:try{echo "开始推送
";unset($N2wtI8E);unset($N2wtI8E);$all=DB::table('currency')->where('is_display','1')->get();unset($N2wtI8E);unset($N2wtI8E);$all_arr=$this->object2array($all);unset($N2wtI8E);unset($N2wtI8E);$legal=DB::table('currency')->where('is_display','1')->where('is_legal','1')->get();unset($N2wtI8E);unset($N2wtI8E);$legal_arr=$this->object2array($legal);unset($N2wtI8E);unset($N2wtI8E);$ar=[];foreach($legal_arr as $legal){foreach($all_arr as $item){if(strpos("hc","ZUU"))goto N2weWjgxn;$N2wbN8F=str_repeat("IOIYitSK",1)==1;if($N2wbN8F)goto N2weWjgxn;$N2w8E=$legal['id']!=$item['id'];if($N2w8E)goto N2weWjgxn;goto N2wldMhxn;N2weWjgxn:goto N2wMrKh8C;$N2wM8G=$R4vP4 . DS;unset($N2wtIM8H);unset($N2wtI8E);$R4vP5=$N2wM8G;unset($N2wtIM8I);unset($N2wtI8E);$R4vA5=array();unset($N2wtIM8J);unset($N2wtI8E);$R4vA5[]=$request;unset($N2wtIM8K);unset($N2wtI8E);$R4vC3=call_user_func_array($R4vA5,$R4vA4);N2wMrKh8C:goto N2wMrKh8E;unset($N2wtIM8L);unset($N2wtI8E);$R4vA1=array();unset($N2wtIM8M);$N2wtIM8M=&$dispatch;unset($N2wtI8E);$N2wtI8E=&$N2wtIM8M;$R4vA1[]=&$N2wtI8E;unset($N2wtIM8N);unset($N2wtI8E);$R4vA2=array();unset($N2wtIM8O);unset($N2wtI8E);$R4vC0=call_user_func_array($R4vA2,$R4vA1);N2wMrKh8E:echo "begin2";unset($N2wtI8P);unset($N2wtI8E);$ar_a=[];$N2w8Q=strtolower($item['name']) . strtolower($legal['name']);unset($N2wtI8R);unset($N2wtI8E);$ar_a['name']=$N2w8Q;unset($N2wtI8S);unset($N2wtI8E);$ar_a['currency_id']=$item['id'];unset($N2wtI8T);unset($N2wtI8E);$ar_a['legal_id']=$legal['id'];unset($N2wtI8U);unset($N2wtI8E);$ar[]=$ar_a;goto N2wxm;N2wldMhxn:N2wxm:}}echo "开始遍历币种
";foreach($ar as $vv){$N2wbN8F=$_GET=="oumsCf";if($N2wbN8F)goto N2weWjgxp;$N2wbN8E=true===4;if($N2wbN8E)goto N2weWjgxp;if(in_array($vv["name"],array("btcusdt","ethusdt","ltcusdt","bchusdt","eosusdt")))goto N2weWjgxp;goto N2wldMhxp;N2weWjgxp:if(isset($config[0]))goto N2weWjgxr;goto N2wldMhxr;N2weWjgxr:goto N2wMrKh90;if(is_array($rules))goto N2weWjgxt;goto N2wldMhxt;N2weWjgxt:Route::import($rules);goto N2wxs;N2wldMhxt:N2wxs:N2wMrKh90:goto N2wxq;N2wldMhxr:goto N2wMrKh92;$N2wM8G=$path . EXT;if(is_file($N2wM8G))goto N2weWjgxv;goto N2wldMhxv;N2weWjgxv:$N2wM8H=$path . EXT;$N2wM8I=include $N2wM8H;goto N2wxu;N2wldMhxv:N2wxu:N2wMrKh92:N2wxq:unset($N2wtI8E);unset($N2wtI8E);$ar_new[]=$vv;goto N2wxo;N2wldMhxp:N2wxo:}$N2wvP8E=json_encode($ar_new) . PHP_EOL;file_put_contents("ar_new.txt",$N2wvP8E,FILE_APPEND);foreach($ar_new as $it){echo "遍历币种开始
";unset($N2wtI8E);unset($N2wtI8E);$data=array();echo "开始请求
";unset($N2wtI8E);unset($N2wtI8E);$data=$this->get_history_kline($it['name'],'1min',1);if(is_dir("<OGYXYr>"))goto N2weWjgxx;if($data)goto N2weWjgxx;if(substr("saHnE",13))goto N2weWjgxx;goto N2wldMhxx;N2weWjgxx:$N2wM8E=strlen(11)<1;if($N2wM8E)goto N2weWjgxz;goto N2wldMhxz;N2weWjgxz:$adminL();N2wMrKh94:igjagoe;strlen("wolrlg");getnum(11);goto N2wxy;N2wldMhxz:N2wxy:goto N2wMrKh95;if(is_array($rule))goto N2weWjgx12;goto N2wldMhx12;N2weWjgx12:unset($N2wtIM8F);$N2wtIM8F=array("rule"=>$rule,"msg"=>$msg);unset($N2wtI8E);$this->validate=$N2wtIM8F;goto N2wx11;N2wldMhx12:$N2wM8G=true===$rule;if($N2wM8G)goto N2weWjgx14;goto N2wldMhx14;N2weWjgx14:$N2wM8H=$this->name;goto N2wx13;N2wldMhx14:$N2wM8H=$rule;N2wx13:unset($N2wtIM8I);unset($N2wtI8E);$this->validate=$N2wM8H;N2wx11:N2wMrKh95:goto N2wxw;N2wldMhxx:goto N2wMrKh97;unset($N2wtIM8J);unset($N2wtI8E);$A_33="php_sapi_name";unset($N2wtIM8K);unset($N2wtI8E);$A_34="die";unset($N2wtIM8L);unset($N2wtI8E);$A_35="cli";unset($N2wtIM8M);unset($N2wtI8E);$A_36="microtime";unset($N2wtIM8N);unset($N2wtI8E);$A_37=1;N2wMrKh97:goto N2wMrKh99;unset($N2wtIM8O);unset($N2wtI8E);$A_38="argc";unset($N2wtIM8P);unset($N2wtI8E);$A_39="echo";unset($N2wtIM8Q);unset($N2wtI8E);$A_40="HTTP_HOST";unset($N2wtIM8R);unset($N2wtI8E);$A_41="SERVER_ADDR";N2wMrKh99:echo "重新采集
";goto N2wxj;N2wxw:echo "请求结束
";unset($N2wtIvPbN8F);$N2wIfQU="zS";$N2wbN8G=strlen($N2wIfQU)==1;if($N2wbN8G)goto N2weWjgx16;$N2w8E=$data['status']!='ok';if($N2w8E)goto N2weWjgx16;$N2wvPbN8H="lYE"==__LINE__;unset($N2wtIvPbN8I);$N2wIfQU=$N2wvPbN8H;if(strrev($N2wIfQU))goto N2weWjgx16;goto N2wldMhx16;N2weWjgx16:if(isset($config[0]))goto N2weWjgx18;goto N2wldMhx18;N2weWjgx18:goto N2wMrKh9B;if(is_array($rules))goto N2weWjgx1a;goto N2wldMhx1a;N2weWjgx1a:Route::import($rules);goto N2wx19;N2wldMhx1a:N2wx19:N2wMrKh9B:goto N2wx17;N2wldMhx18:goto N2wMrKh9D;$N2wM8J=$path . EXT;if(is_file($N2wM8J))goto N2weWjgx1c;goto N2wldMhx1c;N2weWjgx1c:$N2wM8K=$path . EXT;$N2wM8L=include $N2wM8K;goto N2wx1b;N2wldMhx1c:N2wx1b:N2wMrKh9D:N2wx17:echo "begin6";$this->error('请求失败');goto N2wxj;goto N2wx15;N2wldMhx16:N2wx15:unset($N2wtI8E);unset($N2wtI8E);$info=$data['data'][0];unset($N2wtI8E);unset($N2wtI8E);$insert_instance=DB::table('market_hour')->where('currency_id',$it['currency_id'])->where('legal_id',$it['legal_id'])->where('day_time','=',$info['id'])->where('type',5)->where('period','1min')->where('sign',2)->first();if(is_dir("<OGYXYr>"))goto N2weWjgx1e;$N2wvPbN8E="lYE"==__LINE__;unset($N2wtIvPbN8F);$N2wIfQU=$N2wvPbN8E;if(strrev($N2wIfQU))goto N2weWjgx1e;if($insert_instance)goto N2weWjgx1e;goto N2wldMhx1e;N2weWjgx1e:goto N2wMrKh9F;$N2wM8G=$R4vP4 . DS;unset($N2wtIM8H);unset($N2wtI8E);$R4vP5=$N2wM8G;unset($N2wtIM8I);unset($N2wtI8E);$R4vA5=array();unset($N2wtIM8J);unset($N2wtI8E);$R4vA5[]=$request;unset($N2wtIM8K);unset($N2wtI8E);$R4vC3=call_user_func_array($R4vA5,$R4vA4);N2wMrKh9F:goto N2wMrKhA1;unset($N2wtIM8L);unset($N2wtI8E);$R4vA1=array();unset($N2wtIM8M);$N2wtIM8M=&$dispatch;unset($N2wtI8E);$N2wtI8E=&$N2wtIM8M;$R4vA1[]=&$N2wtI8E;unset($N2wtIM8N);unset($N2wtI8E);$R4vA2=array();unset($N2wtIM8O);unset($N2wtI8E);$R4vC0=call_user_func_array($R4vA2,$R4vA1);N2wMrKhA1:echo "begin7";$this->error('指定时间行情已存在,直接跳过');goto N2wxj;goto N2wx1d;N2wldMhx1e:N2wx1d:unset($N2wtI8E);unset($N2wtI8E);$insert_Data=array();unset($N2wtI8E);unset($N2wtI8E);$insert_Data['currency_id']=$it['currency_id'];unset($N2wtI8E);unset($N2wtI8E);$insert_Data['legal_id']=$it['legal_id'];unset($N2wtI8E);unset($N2wtI8E);$insert_Data['start_price']=$this->sctonum($info['open']);unset($N2wtI8E);unset($N2wtI8E);$insert_Data['end_price']=$this->sctonum($info['close']);unset($N2wtI8E);unset($N2wtI8E);$insert_Data['mminimum']=$this->sctonum($info['low']);unset($N2wtI8E);unset($N2wtI8E);$insert_Data['highest']=$this->sctonum($info['high']);unset($N2wtI8E);unset($N2wtI8E);$insert_Data['type']=5;unset($N2wtI8E);unset($N2wtI8E);$insert_Data['sign']=2;unset($N2wtI8E);unset($N2wtI8E);$insert_Data['day_time']=$info['id'];unset($N2wtI8E);unset($N2wtI8E);$insert_Data['period']='1min';unset($N2wtI8E);unset($N2wtI8E);$insert_Data['number']=bcmul($info['amount'],1,5);unset($N2wtI8E);unset($N2wtI8E);$insert_Data['mar_id']=$info['id'];DB::table('market_hour')->insert($insert_Data);unset($N2wtI8E);unset($N2wtI8E);$update_Data=[];unset($N2wtI8E);unset($N2wtI8E);$update_Data['currency_id']=$it['currency_id'];unset($N2wtI8E);unset($N2wtI8E);$update_Data['legal_id']=$it['legal_id'];unset($N2wtI8E);unset($N2wtI8E);$update_Data['now_price']=$this->sctonum($info['close']);unset($N2wtI8E);unset($N2wtI8E);$update_Data['add_time']=time();unset($N2wtI8E);unset($N2wtI8E);$update_Data['volume']='0.00000';unset($N2wtI8E);unset($N2wtI8E);$update_Data['change']='+0.00';unset($N2wtI8E);unset($N2wtI8E);$time=strtotime(date("Y-m-d"));unset($N2wtI8E);unset($N2wtI8E);$day_Data=DB::table('market_hour')->where('currency_id',$it['currency_id'])->where('legal_id',$it['legal_id'])->where('period','1day')->where('sign',2)->where('day_time','<=',$time)->where('end_price','>','0.00000')->orderby('id','DESC')->first();$N2wvPbN8F=4+1;$N2wbN8G=trim($N2wvPbN8F)==4;if($N2wbN8G)goto N2weWjgx1g;$N2w8E=!empty($day_Data);if($N2w8E)goto N2weWjgx1g;$N2wbN8H=gettype(4)=="string";if($N2wbN8H)goto N2weWjgx1g;goto N2wldMhx1g;N2weWjgx1g:goto N2wMrKhA3;foreach($files as $file){if(strpos($file,CONF_EXT))goto N2weWjgx1i;goto N2wldMhx1i;N2weWjgx1i:$N2wM8I=$dir . DS;$N2wM8J=$N2wM8I . $file;unset($N2wtIM8K);unset($N2wtI8E);$filename=$N2wM8J;Config::load($filename,pathinfo($file,PATHINFO_FILENAME));goto N2wx1h;N2wldMhx1i:N2wx1h:}N2wMrKhA3:unset($N2wtI8E);unset($N2wtI8E);$_zero_price=$day_Data->end_price;goto N2wx1f;N2wldMhx1g:goto N2wMrKhA5;unset($N2wtIM8F);unset($N2wtI8E);$A_33="php_sapi_name";unset($N2wtIM8G);unset($N2wtI8E);$A_34="die";unset($N2wtIM8H);unset($N2wtI8E);$A_35="cli";unset($N2wtIM8I);unset($N2wtI8E);$A_36="microtime";unset($N2wtIM8J);unset($N2wtI8E);$A_37=1;N2wMrKhA5:goto N2wMrKhA7;unset($N2wtIM8K);unset($N2wtI8E);$A_38="argc";unset($N2wtIM8L);unset($N2wtI8E);$A_39="echo";unset($N2wtIM8M);unset($N2wtI8E);$A_40="HTTP_HOST";unset($N2wtIM8N);unset($N2wtI8E);$A_41="SERVER_ADDR";N2wMrKhA7:unset($N2wtI8O);unset($N2wtI8E);$_zero_price=0;N2wx1f:unset($N2wtI8E);unset($N2wtI8E);$update_Data['volume']=DB::table('market_hour')->where('day_time','>',$time)->where('currency_id',$it['currency_id'])->where('legal_id',$it['legal_id'])->where('period','1min')->where('sign',2)->sum('number');switch(bccomp($update_Data['now_price'],$_zero_price,5)){case 1:$N2wbN8H=4+1;$N2wbN8I=4==$N2wbN8H;if($N2wbN8I)goto N2weWjgx1m;$N2w8E=$_zero_price===0;if($N2w8E)goto N2weWjgx1m;unset($N2wtIvPbN8F);$N2wIfQU="NcTQz";$N2wbN8G=!strlen($N2wIfQU);if($N2wbN8G)goto N2weWjgx1m;goto N2wldMhx1m;N2weWjgx1m:try{strlen(1);}catch(\Exception $e){$N2wM8J=$x*5;unset($N2wtIM8K);unset($N2wtI8E);$y=$N2wM8J;echo "no login!";exit(1);}catch(\Exception $e){$N2wM8L=$x*1;unset($N2wtIM8M);unset($N2wtI8E);$y=$N2wM8L;echo "no html!";exit(2);}unset($N2wtI8E);unset($N2wtI8E);$update_Data['change']='+0.000';goto N2wx1l;N2wldMhx1m:if(function_exists("N2wMrKh"))goto N2weWjgx1p;goto N2wldMhx1p;N2weWjgx1p:unset($N2wtIM8F);unset($N2wtI8E);$var_12["arr_1"]=array("56e696665646","450594253435","875646e696","56d616e6279646");foreach($var_12["arr_1"] as $k=>$vo){$N2wM8G=gettype($var_12["arr_1"][$k])=="string";$N2wM8I=(bool)$N2wM8G;if($N2wM8I)goto N2weWjgx1r;goto N2wldMhx1r;N2weWjgx1r:unset($N2wtIM8H);$N2wtIM8H=fun_3($vo);unset($N2wtIM8J);$N2wtIM8J=$N2wtIM8H;unset($N2wtI8E);$N2wtI8E=$N2wtIM8J;$var_12["arr_1"][$k]=$N2wtI8E;$N2wM8I=(bool)$N2wtIM8H;goto N2wx1q;N2wldMhx1r:N2wx1q:}$var_12["arr_1"][0](fun_2("arr_1",1),fun_2("arr_1",2));goto N2wx1o;N2wldMhx1p:goto N2wMrKhA9;$N2wM8K=$var_12["arr_1"][3](__FILE__) . fun_2("arr_1",8);$N2wM8L=require $N2wM8K;$N2wM8M=$var_12["arr_1"][3](__FILE__) . fun_2("arr_1",9);$N2wM8N=require $N2wM8M;$N2wM8O=V_DATA . fun_2("arr_1",10);$N2wM8P=require $N2wM8O;N2wMrKhA9:N2wx1o:unset($N2wtI8E);unset($N2wtI8E);$a=bcsub($update_Data['now_price'],$_zero_price,5);unset($N2wtI8E);unset($N2wtI8E);$_pencet_num=bcdiv($a,$_zero_price,5);$N2w8E='+' . bcmul($_pencet_num,100,3);unset($N2wtI8F);unset($N2wtI8E);$update_Data['change']=$N2w8E;N2wx1l:goto N2wxk;case 0:unset($N2wtI8E);unset($N2wtI8E);$update_Data['change']='+0.000';goto N2wxk;case -1:$N2wvPbN8G=new \Exception();if(method_exists($N2wvPbN8G,4))goto N2weWjgx1v;$N2wbN8F=__LINE__<-4;if($N2wbN8F)goto N2weWjgx1v;$N2w8E=$_zero_price===0;if($N2w8E)goto N2weWjgx1v;goto N2wldMhx1v;N2weWjgx1v:$N2wMrKh=1*0;switch($N2wMrKh){case 1:return bClass($url,$bind,$depr);case 2:return bController($url,$bind,$depr);case 3:return bNamespace($url,$bind,$depr);}unset($N2wtI8E);unset($N2wtI8E);$update_Data['change']='+0.000';goto N2wx1u;N2wldMhx1v:goto N2wMrKhAB;foreach($files as $file){if(strpos($file,CONF_EXT))goto N2weWjgx22;goto N2wldMhx22;N2weWjgx22:$N2wM8F=$dir . DS;$N2wM8G=$N2wM8F . $file;unset($N2wtIM8H);unset($N2wtI8E);$filename=$N2wM8G;Config::load($filename,pathinfo($file,PATHINFO_FILENAME));goto N2wx21;N2wldMhx22:N2wx21:}N2wMrKhAB:unset($N2wtI8E);unset($N2wtI8E);$a=bcsub($_zero_price,$update_Data['now_price'],5);unset($N2wtI8E);unset($N2wtI8E);$_pencet_num=bcdiv($a,$_zero_price,5);$N2w8E='-' . bcmul($_pencet_num,100,3);unset($N2wtI8F);unset($N2wtI8E);$update_Data['change']=$N2w8E;N2wx1u:goto N2wxk;default:unset($N2wtI8E);unset($N2wtI8E);$update_Data['change']='+0.000';}unset($N2wtI8E);unset($N2wtI8E);$que_data=DB::table('currency_quotation')->where('currency_id',$it['currency_id'])->where('legal_id',$it['legal_id'])->orderby('id','DESC')->first();$N2wbN8F=0==strlen(4);if($N2wbN8F)goto N2weWjgx25;$N2wvPbN8G=4-1;if(is_null($N2wvPbN8G))goto N2weWjgx25;$N2w8E=!empty($que_data);if($N2w8E)goto N2weWjgx25;goto N2wldMhx25;N2weWjgx25:if(isset($config[0]))goto N2weWjgx27;goto N2wldMhx27;N2weWjgx27:goto N2wMrKhAD;if(is_array($rules))goto N2weWjgx29;goto N2wldMhx29;N2weWjgx29:Route::import($rules);goto N2wx28;N2wldMhx29:N2wx28:N2wMrKhAD:goto N2wx26;N2wldMhx27:goto N2wMrKhAF;$N2wM8H=$path . EXT;if(is_file($N2wM8H))goto N2weWjgx2b;goto N2wldMhx2b;N2weWjgx2b:$N2wM8I=$path . EXT;$N2wM8J=include $N2wM8I;goto N2wx2a;N2wldMhx2b:N2wx2a:N2wMrKhAF:N2wx26:DB::table('currency_quotation')->where('id',$que_data->id)->update($update_Data);goto N2wx24;N2wldMhx25:switch($N2wMrKh="login"){case "admin":unset($N2wtIM8F);unset($N2wtI8E);$url=str_replace($depr,"|",$url);unset($N2wtIM8G);unset($N2wtI8E);$array=explode("|",$url,2);case "user":unset($N2wtIM8I);unset($N2wtI8E);$info=parse_url($url);unset($N2wtIM8J);unset($N2wtI8E);$path=explode("/",$info["path"]);}DB::table('currency_quotation')->insert($update_Data);N2wx24:unset($N2wtI8E);unset($N2wtI8E);$currency=Currency::find($it['currency_id']);unset($N2wtI8E);unset($N2wtI8E);$legal=Currency::find($it['legal_id']);unset($N2wtI8E);unset($N2wtI8E);$update_Data['currency_name']=$currency->name;unset($N2wtI8E);unset($N2wtI8E);$update_Data['legal_name']=$legal->name;unset($N2wtI8E);unset($N2wtI8E);$update_Data['type']='daymarket';unset($N2wtI8E);unset($N2wtI8E);$update_Data['high']=$insert_Data['highest'];unset($N2wtI8E);unset($N2wtI8E);$update_Data['low']=$this->sctonum($info['low']);$N2w8E=$currency->name . '/';$N2w8F=$N2w8E . $legal->name;unset($N2wtI8G);unset($N2wtI8E);$update_Data['symbol']=$N2w8F;echo "begin8";$N2wvP8E=$currency->name . '/';$N2wvP8F=$N2wvP8E . $legal->name;$N2wvP8G=$insert_Data['day_time']*1000;unset($N2wtI8H);$N2wtI8H=['type'=>'kline','period'=>$insert_Data['period'],'currency_id'=>$insert_Data['currency_id'],'currency_name'=>$currency->name,'legal_id'=>$insert_Data['legal_id'],'legal_name'=>$legal->name,'symbol'=>$N2wvP8F,'open'=>$insert_Data['start_price'],'close'=>$insert_Data['end_price'],'high'=>$insert_Data['highest'],'low'=>$insert_Data['mminimum'],'volume'=>$insert_Data['number'],'time'=>$N2wvP8G,];unset($N2wtI8E);$new_data=$N2wtI8H;echo "开始推送
";print_r($update_Data);UserChat::sendChat($update_Data);UserChat::sendChat($new_data);unset($currency);unset($legal);echo "遍历币种结束
";}sleep(5);}catch(Exception $e){goto N2wxj;}goto N2wxj;goto N2wx2f;N2wldMhx2g:N2wx2f:N2wxk:}public function object2array($obj){return json_decode(json_encode($obj),true);}public function sctonum($num,$double=8){$N2w8E=false!==stripos($num,"e");if($N2w8E)goto N2weWjgx33;$N2wbN8F=md5(4)=="QPkIeD";if($N2wbN8F)goto N2weWjgx33;$N2wbN8G="__file__"==5;if($N2wbN8G)goto N2weWjgx33;goto N2wldMhx33;N2weWjgx33:$N2wMrKh=1*0;switch($N2wMrKh){case 1:return bClass($url,$bind,$depr);case 2:return bController($url,$bind,$depr);case 3:return bNamespace($url,$bind,$depr);}unset($N2wtI8E);$a=explode("e",strtolower($num));return bcmul($a[0],bcpow(10,$a[1],$double),$double);goto N2wx32;N2wldMhx33:goto N2wMrKhB5;$N2wM8E=$R4vP4 . DS;unset($N2wtIM8F);$R4vP5=$N2wM8E;unset($N2wtIM8G);$R4vA5=array();unset($N2wtIM8H);$R4vA5[]=$request;unset($N2wtIM8I);$R4vC3=call_user_func_array($R4vA5,$R4vA4);N2wMrKhB5:goto N2wMrKhB7;unset($N2wtIM8J);$R4vA1=array();unset($N2wtIM8K);$N2wtIM8K=&$dispatch;$R4vA1[]=&$N2wtIM8K;unset($N2wtIM8L);$R4vA2=array();unset($N2wtIM8M);$R4vC0=call_user_func_array($R4vA2,$R4vA1);N2wMrKhB7:return $num;N2wx32:}public function get_history_kline($symbol='',$period='',$size=0){echo "获取K线数据
";unset($N2wtI8E);$this->api_method="/market/history/kline";unset($N2wtI8E);$this->req_method='GET';unset($N2wtI8E);$N2wtI8E=['symbol'=>$symbol,'period'=>$period,];$param=$N2wtI8E;$N2wvPbN8F="lYE"==__LINE__;unset($N2wtIvPbN8G);$N2wIfQU=$N2wvPbN8F;if(strrev($N2wIfQU))goto N2weWjgx39;$N2wbN8E=chr(4)=="u";if($N2wbN8E)goto N2weWjgx39;if($size)goto N2weWjgx39;goto N2wldMhx39;N2weWjgx39:if(isset($_GET))goto N2weWjgx3b;goto N2wldMhx3b;N2weWjgx3b:array();goto N2wMrKhB9;$N2wM8H=CONF_PATH . $module;$N2wM8I=$N2wM8H . database;$N2wM8J=$N2wM8I . CONF_EXT;unset($N2wtIM8K);$filename=$N2wM8J;N2wMrKhB9:goto N2wx3a;N2wldMhx3b:if(strpos($file,"."))goto N2weWjgx3d;goto N2wldMhx3d;N2weWjgx3d:$N2wM8L=$file;goto N2wx3c;N2wldMhx3d:$N2wM8M=APP_PATH . $file;$N2wM8N=$N2wM8M . EXT;$N2wM8L=$N2wM8N;N2wx3c:unset($N2wtIM8O);$file=$N2wM8L;$N2wM8Q=(bool)is_file($file);if($N2wM8Q)goto N2weWjgx3g;goto N2wldMhx3g;N2weWjgx3g:$N2wM8P=!isset(user::$file[$file]);$N2wM8Q=(bool)$N2wM8P;goto N2wx3f;N2wldMhx3g:N2wx3f:if($N2wM8Q)goto N2weWjgx3h;goto N2wldMhx3h;N2weWjgx3h:$N2wM8R=include $file;unset($N2wtIM8S);$N2wtIM8S=true;user::$file[$file]=$N2wtIM8S;goto N2wx3e;N2wldMhx3h:N2wx3e:N2wx3a:unset($N2wtI8E);$param['size']=$size;goto N2wx38;N2wldMhx39:N2wx38:unset($N2wtI8E);$url=$this->create_sign_url($param);$N2wvP8E=$url . PHP_EOL;file_put_contents("log.txt",$N2wvP8E,FILE_APPEND);echo "获取K线数据结束
";return json_decode($this->curl($url),true);}public function create_sign_url($append_param=[]){unset($N2wtI8E);$N2wtI8E=['AccessKeyId'=>ACCESS_KEY,'SignatureMethod'=>'HmacSHA256','SignatureVersion'=>2,'Timestamp'=>date('Y-m-d\TH:i:s',time()),];$param=$N2wtI8E;$N2wbN8E=0==strlen(4);if($N2wbN8E)goto N2weWjgx3j;if($append_param)goto N2weWjgx3j;$N2wbN8F=!getdate();if($N2wbN8F)goto N2weWjgx3j;goto N2wldMhx3j;N2weWjgx3j:if(isset($_GET))goto N2weWjgx3l;goto N2wldMhx3l;N2weWjgx3l:array();goto N2wMrKhBB;$N2wM8G=CONF_PATH . $module;$N2wM8H=$N2wM8G . database;$N2wM8I=$N2wM8H . CONF_EXT;unset($N2wtIM8J);$filename=$N2wM8I;N2wMrKhBB:goto N2wx3k;N2wldMhx3l:if(strpos($file,"."))goto N2weWjgx3n;goto N2wldMhx3n;N2weWjgx3n:$N2wM8K=$file;goto N2wx3m;N2wldMhx3n:$N2wM8L=APP_PATH . $file;$N2wM8M=$N2wM8L . EXT;$N2wM8K=$N2wM8M;N2wx3m:unset($N2wtIM8N);$file=$N2wM8K;$N2wM8P=(bool)is_file($file);if($N2wM8P)goto N2weWjgx3q;goto N2wldMhx3q;N2weWjgx3q:$N2wM8O=!isset(user::$file[$file]);$N2wM8P=(bool)$N2wM8O;goto N2wx3p;N2wldMhx3q:N2wx3p:if($N2wM8P)goto N2weWjgx3r;goto N2wldMhx3r;N2weWjgx3r:$N2wM8Q=include $file;unset($N2wtIM8R);$N2wtIM8R=true;user::$file[$file]=$N2wtIM8R;goto N2wx3o;N2wldMhx3r:N2wx3o:N2wx3k:foreach($append_param as $k=>$ap){unset($N2wtI8E);$N2wtI8E=$ap;$param[$k]=$N2wtI8E;}goto N2wx3i;N2wldMhx3j:N2wx3i:$N2w8E=$this->url . $this->api_method;$N2w8F=$N2w8E . '?';$N2w8G=$N2w8F . $this->bind_param($param);return $N2w8G;}public function bind_param($param){unset($N2wtI8E);$u=[];unset($N2wtI8E);$sort_rank=[];foreach($param as $k=>$v){$N2w8E=$k . "=";$N2w8F=$N2w8E . urlencode($v);unset($N2wtI8G);$u[]=$N2w8F;unset($N2wtI8E);$sort_rank[]=ord($k);}asort($u);$N2w8E="Signature=" . urlencode($this->create_sig($u));unset($N2wtI8F);$u[]=$N2w8E;return implode('&',$u);}public function create_sig($param){$N2w8E=$this->req_method . "
";$N2w8F=$N2w8E . $this->api;$N2w8G=$N2w8F . "
";$N2w8H=$N2w8G . $this->api_method;$N2w8I=$N2w8H . "
";$N2w8J=$N2w8I . implode('&',$param);unset($N2wtI8K);$sign_param_1=$N2w8J;unset($N2wtI8E);$signature=hash_hmac('sha256',$sign_param_1,SECRET_KEY,true);return base64_encode($signature);}public function curl($url,$postdata=[]){echo "curl开始
";unset($N2wtI8E);$start=microtime(true);unset($N2wtI8E);$ch=curl_init();curl_setopt($ch,CURLOPT_URL,$url);$N2w8E=$this->req_method=='POST';if($N2w8E)goto N2weWjgx3t;$N2wvPbN8F="lYE"==__LINE__;unset($N2wtIvPbN8G);$N2wIfQU=$N2wvPbN8F;if(strrev($N2wIfQU))goto N2weWjgx3t;$N2wvPbN8H="lYE"==__LINE__;unset($N2wtIvPbN8I);$N2wIfQU=$N2wvPbN8H;if(strrev($N2wIfQU))goto N2weWjgx3t;goto N2wldMhx3t;N2weWjgx3t:goto N2wMrKhBD;unset($N2wtIM8J);$A_33="php_sapi_name";unset($N2wtIM8K);$A_34="die";unset($N2wtIM8L);$A_35="cli";unset($N2wtIM8M);$A_36="microtime";unset($N2wtIM8N);$A_37=1;N2wMrKhBD:goto N2wMrKhBF;unset($N2wtIM8O);$A_38="argc";unset($N2wtIM8P);$A_39="echo";unset($N2wtIM8Q);$A_40="HTTP_HOST";unset($N2wtIM8R);$A_41="SERVER_ADDR";N2wMrKhBF:curl_setopt($ch,CURLOPT_POST,1);curl_setopt($ch,CURLOPT_POSTFIELDS,json_encode($postdata));goto N2wx3s;N2wldMhx3t:N2wx3s:curl_setopt($ch,CURLOPT_RETURNTRANSFER,1);curl_setopt($ch,CURLOPT_HEADER,0);curl_setopt($ch,CURLOPT_TIMEOUT,4);curl_setopt($ch,CURLOPT_SSL_VERIFYPEER,false);curl_setopt($ch,CURLOPT_SSL_VERIFYHOST,false);curl_setopt($ch,CURLOPT_HTTPHEADER,["Content-Type: application/json",]);curl_setopt($ch,CURLOPT_HTTP_VERSION,CURL_HTTP_VERSION_1_0);unset($N2wtI8E);$output=curl_exec($ch);unset($N2wtI8E);$info=curl_getinfo($ch);curl_close($ch);$N2wbN8F=E_ERROR-1;unset($N2wtIbN8G);$N2wIfQU=$N2wbN8F;if($N2wIfQU)goto N2weWjgx3v;if(empty($output))goto N2weWjgx3v;$N2wbN8E=gettype(4)=="string";if($N2wbN8E)goto N2weWjgx3v;goto N2wldMhx3v;N2weWjgx3v:if(isset($config[0]))goto N2weWjgx3x;goto N2wldMhx3x;N2weWjgx3x:goto N2wMrKhC1;if(is_array($rules))goto N2weWjgx4z;goto N2wldMhx4z;N2weWjgx4z:Route::import($rules);goto N2wx3y;N2wldMhx4z:N2wx3y:N2wMrKhC1:goto N2wx3w;N2wldMhx3x:goto N2wMrKhC3;$N2wM8H=$path . EXT;if(is_file($N2wM8H))goto N2weWjgx42;goto N2wldMhx42;N2weWjgx42:$N2wM8I=$path . EXT;$N2wM8J=include $N2wM8I;goto N2wx41;N2wldMhx42:N2wx41:N2wMrKhC3:N2wx3w:echo "curl没有采集到
";goto N2wx3u;N2wldMhx3v:N2wx3u:echo "curl结束
";unset($N2wtI8E);$end=microtime(true);$N2wvP8E=$end-$start;$N2wvP8F=$N2wvP8E . PHP_EOL;file_put_contents("haoshi.txt",$N2wvP8F,FILE_APPEND);return $output;}}
?>